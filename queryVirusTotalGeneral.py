import requests

# Code Objectives
# Query VirusTotal (General)

headers = {
    "accept": "application/json",
    "x-apikey": "Enter API KEY HERE"
}

def queryVirusTotal():
    counter = 1
    with open("final_dataset12.txt", 'r') as file:
            for fileHash in file:
                response = requests.get("https://www.virustotal.com/api/v3/files/"+ str(fileHash).rstrip()+ "/behaviours?limit=10", headers=headers)           
                with open(str(fileHash).rstrip() + '.json', 'w') as f:
                    f.write(response.text)
                    print("Response: ", response, "Hash Name: ", fileHash, "Samples Collected : ", counter)
                    counter += 1
                    if response.status_code == 429:
                        updateTxt(counter)
                        break
                    
def updateTxt(counter):
    with open("final_dataset12.txt", "r") as file:
        removeLines = file.readlines()
        with open("final_dataset12.txt", "w+") as file2:
            file2.writelines(removeLines[counter - 2:]) ###https://pynative.com/python-delete-lines-from-file/
                    
def main():
    queryVirusTotal()

main()
